var debug=!0,log=function(e){debug&&console.log(e)},percentChg=function(e,r){return 0!==r?(e-r)/(e+r)*100:0};Number.prototype.format=function(e,r,t,n){var o="\\d(?=(\\d{"+(r||3)+"})+"+(e>0?"\\D":"$")+")",u=this.toFixed(Math.max(0,~~e));return(n?u.replace(".",n):u).replace(new RegExp(o,"g"),"$&"+(t||","))};
var map,gmap=function(o){"use strict";function n(){log("gmap.init() loaded"),i.mapcanvas=o(".js-gmap"),i.mapcanvas.length?a():log("gmap.init(): no mapcanvas found")}function a(){var o=document.createElement("script");o.type="text/javascript",o.id="new-gmap",o.src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAF1sRGF7ku7L3dKictevzxUTPWc2YF6NI&callback=gmap.build",document.body.appendChild(o)}function e(){var n=o.extend({},i.mapDefaults,{zoom:i.zoom,center:new google.maps.LatLng(i.latCenter,i.lonCenter),zoomControlOptions:{position:google.maps.ControlPosition.LEFT_CENTER},maxZoom:i.maxZoom,minZoom:i.minZoom,styles:[]});map=new google.maps.Map(i.mapcanvas[0],n)}function t(o,n,a){var e=new google.maps.Geocoder,t=[];e.geocode({address:n},function(n,e){e==google.maps.GeocoderStatus.OK&&(t[0]=n[0].geometry.location.lat(),t[1]=n[0].geometry.location.lng(),l[o]=t,m(t,o,a))})}function m(o,n,a){var e=new google.maps.InfoWindow({content:a}),t=new google.maps.Marker({position:{lat:o[0],lng:o[1]},map:map,title:n,infowindow:e});p.push(t),google.maps.event.addListener(t,"click",function(){p.map(function(o){o.infowindow.close()}),this.infowindow.open(map,this)})}var i={mapDefaults:{panControl:!1,zoomControl:!0,zoomControlOptions:!0,scaleControl:!1,mapTypeControl:!1,streetViewControl:!1,scrollwheel:!1,zoom:4,maxZoom:16,minZoom:3},mapcanvas:0,latCenter:37.09024,lonCenter:-96.712891},l=[],p=[];return{init:n,build:e,buildMarkers:t}}(jQuery);
var getData=function(e){"use strict";function t(e,t,r){void 0!==t&&(t=t),void 0!==r&&(r=r),"All States"===e&&a()}function a(){e.support.cors=!0,e.isEmptyObject(o)?e.ajax({url:"state_code.json",method:"GET",dataType:"json",success:function(e){r(e)},error:function(){log("csv failed refreshed 2")}}):r(o)}function r(t){if(!e.isEmptyObject(d))return void log("state data already exists");o=t;var a=[],r=[];for(var s in o){var i="https://www.quandl.com/api/v3/datasets/ZILL/S@stateCode_A.json?collapse=annual&api_key=1aGVznRZH7ckoyhVtges".replace("@stateCode",o[s]);a.push(i),r.push(s)}n(a,r,-1)}function n(t,a,r){r>=3||setTimeout(function(){-1===r?(log("make sync request: initialize -1 to negate setTimeout effect"),r+=1,e.ajax({url:t[r+1],success:function(e){n(t,a,r),s(e,a[r])}})):(log("make sync request: "+r),e.ajax({url:t[r],method:"GET",dataType:"json",success:function(e){r+=1,n(t,a,r),s(e,a[r])},error:function(){log("state data failed: "+r)}}))},1e3)}function s(e,t){var a=e.dataset.data;d[t]={HousePriceYr1:a[0][1],HousePriceYr3:2 in a?a[2][1]:0,HousePriceYr5:4 in a?a[4][1]:0,HousePriceYr10:9 in a?a[9][1]:0,PriceChangeYr1:percentChg(a[0][1],a[1][1]),PriceChangeYr3:percentChg(a[0][1],2 in a?a[2][1]:0),PriceChangeYr5:percentChg(a[0][1],4 in a?a[4][1]:0),PriceChangeYr10:percentChg(a[0][1],9 in a?a[9][1]:0)},i(d,t)}function i(e,t){var a=t+" "+t+" United States",r=["State: @state <br>","@dataType: @displayData <br>","Data over: @time years"],n=u+"Yr"+c;r=r.join("").replace("@state",t).replace("@dataType",u).replace("@displayData","$"+e[t][n].format(0,3,",")).replace("@time",c),gmap.buildMarkers(t,a,r)}var o={},c=10,u="HousePrice",d={};return{from:t}}(jQuery);
!function(t){"use strict";log("app loaded"),gmap.init(),getData.from("All States")}(jQuery);