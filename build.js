var debug=!0,log=function(a){debug&&console.log(a)},percentChg=function(a,e){return 0!==e?(a-e)/(a+e)*100:0};Number.prototype.format=function(a,e,i,n){var o="\\d(?=(\\d{"+(e||3)+"})+"+(a>0?"\\D":"$")+")",r=this.toFixed(Math.max(0,~~a));return(n?r.replace(".",n):r).replace(new RegExp(o,"g"),"$&"+(i||","))};var abbrState=function(a,e){var n=[["Arizona","AZ"],["Alabama","AL"],["Alaska","AK"],["Arizona","AZ"],["Arkansas","AR"],["California","CA"],["Colorado","CO"],["Connecticut","CT"],["Delaware","DE"],["Florida","FL"],["Georgia","GA"],["Hawaii","HI"],["Idaho","ID"],["Illinois","IL"],["Indiana","IN"],["Iowa","IA"],["Kansas","KS"],["Kentucky","KY"],["Kentucky","KY"],["Louisiana","LA"],["Maine","ME"],["Maryland","MD"],["Massachusetts","MA"],["Michigan","MI"],["Minnesota","MN"],["Mississippi","MS"],["Missouri","MO"],["Montana","MT"],["Nebraska","NE"],["Nevada","NV"],["New Hampshire","NH"],["New Jersey","NJ"],["New Mexico","NM"],["New York","NY"],["North Carolina","NC"],["North Dakota","ND"],["Ohio","OH"],["Oklahoma","OK"],["Oregon","OR"],["Pennsylvania","PA"],["Rhode Island","RI"],["South Carolina","SC"],["South Dakota","SD"],["Tennessee","TN"],["Texas","TX"],["Utah","UT"],["Vermont","VT"],["Virginia","VA"],["Washington","WA"],["West Virginia","WV"],["Wisconsin","WI"],["Wyoming","WY"]];if("abbr"==e){for(a=a.replace(/\w\S*/g,function(a){return a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()}),i=0;i<n.length;i++)if(n[i][0]==a)return n[i][1]}else if("name"==e)for(a=a.toUpperCase(),i=0;i<n.length;i++)if(n[i][1]==a)return n[i][0]};
var map,gmap=function(e){"use strict";function t(){log("gmap.init() loaded"),r.mapcanvas=e(".js-gmap"),r.mapcanvas.length?l():log("gmap.init(): no mapcanvas found")}function l(){var e=document.createElement("script");e.type="text/javascript",e.id="new-gmap",e.src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAF1sRGF7ku7L3dKictevzxUTPWc2YF6NI&callback=gmap.build",document.body.appendChild(e)}function o(){var t=e.extend({},r.mapDefaults,{zoom:r.zoom,center:new google.maps.LatLng(r.latCenter,r.lonCenter),zoomControlOptions:{position:google.maps.ControlPosition.LEFT_CENTER},maxZoom:r.maxZoom,minZoom:r.minZoom,styles:[{elementType:"geometry",stylers:[{color:"#212121"}]},{elementType:"labels.icon",stylers:[{visibility:"off"}]},{elementType:"labels.text.fill",stylers:[{color:"#757575"}]},{elementType:"labels.text.stroke",stylers:[{color:"#212121"}]},{featureType:"administrative",elementType:"geometry",stylers:[{color:"#757575"}]},{featureType:"administrative.country",elementType:"labels.text.fill",stylers:[{color:"#9e9e9e"}]},{featureType:"administrative.land_parcel",stylers:[{visibility:"off"}]},{featureType:"administrative.locality",elementType:"labels.text.fill",stylers:[{color:"#bdbdbd"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#757575"}]},{featureType:"poi.business",stylers:[{visibility:"off"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#181818"}]},{featureType:"poi.park",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#616161"}]},{featureType:"poi.park",elementType:"labels.text.stroke",stylers:[{color:"#1b1b1b"}]},{featureType:"road",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"geometry.fill",stylers:[{color:"#2c2c2c"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#8a8a8a"}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{color:"#373737"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#3c3c3c"}]},{featureType:"road.highway.controlled_access",elementType:"geometry",stylers:[{color:"#4e4e4e"}]},{featureType:"road.local",elementType:"labels.text.fill",stylers:[{color:"#616161"}]},{featureType:"transit",elementType:"labels.text.fill",stylers:[{color:"#757575"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#000000"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#3d3d3d"}]}]});map=new google.maps.Map(r.mapcanvas[0],t)}function a(){var e=new google.maps.LatLng(37.09024,-96.712891);map.panTo(e),map.setZoom(4)}var r={mapDefaults:{panControl:!1,zoomControl:!0,zoomControlOptions:!0,scaleControl:!1,mapTypeControl:!1,streetViewControl:!1,scrollwheel:!1,zoom:4,maxZoom:16,minZoom:3},mapcanvas:0,latCenter:37.09024,lonCenter:-96.712891};return{init:t,build:o,zoomOut:a}}(jQuery);
var mark=function(o){"use strict";function e(e,i,a,r,g){if(!o.isEmptyObject(l[i]))return void s.find(function(o){return o.title===i}).infowindow.setContent(r);n(a,i,function(){t(e,i,r,g)})}function n(o,e,n){log("getLatLng()");var t=new google.maps.Geocoder,i=[];t.geocode({address:o},function(o,t){t==google.maps.GeocoderStatus.OK&&(i[0]=o[0].geometry.location.lat(),i[1]=o[0].geometry.location.lng(),l[e]=i,n())})}function t(o,e,n,t){log("displayMarker()");var a=new google.maps.InfoWindow({content:n}),r=100,g="red";if("All States"!==o){var m=new google.maps.LatLng(l[e][0],l[e][1]);map.panTo(m),map.setZoom(8),r=500,g="yellow"}var c={path:google.maps.SymbolPath.CIRCLE,fillColor:g,fillOpacity:.6,scaledSize:new google.maps.Size(t,t),scale:t/r+4,strokeColor:"white",strokeWeight:0},p=new google.maps.Marker({position:{lat:l[e][0],lng:l[e][1]},icon:c,map:map,title:e,infowindow:a});p.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){p.setAnimation(null)},400),s.push(p),google.maps.event.addListener(p,"click",function(){i(),this.infowindow.open(map,this)})}function i(){s.map(function(o){o.infowindow.close()})}function a(e){if(log("moveToLocation()"),o.isEmptyObject(l[e])){n(e+" United States",e,function(){a(e)})}else{var t=new google.maps.LatLng(l[e][0],l[e][1]);map.panTo(t),map.setZoom(6)}}var l=[],s=[];return{buildMarkers:e,removeMarkers:i,moveToLocation:a}}(jQuery);
var notify=function(e){"use strict";function t(t){e(".js-notify-message").html(l.replace("@state",t)),e(".js-notify-timer").html(""),e(".js-notify-message-last").html(""),e(".js-notify").removeClass("slideOutDown"),e(".js-notify").addClass("slideInUp")}function s(t){e(".js-notify-message").html(a),n(t),e(".js-notify-message-last").html(o),e(".js-notify").removeClass("slideOutDown"),e(".js-notify").addClass("slideInUp")}function n(t){var s=t,n=document.getElementById("countdowntimer"),i=setInterval(function(){s--,n.classList.add("flipInX"),n.innerHTML=s,setTimeout(function(){n.classList.remove("flipInX")},980),e(".js-search-location").submit(function(e){e.preventDefault(),clearInterval(i)}),s<=0&&(e(".js-notify-message").html(""),clearInterval(i),n.innerHTML="sorry",e(".js-notify-message-last").html(r))},1e3)}function i(){e(".js-notify").removeClass("slideInUp"),e(".js-notify").addClass("slideOutDown")}var a="Because this is a free service there is an API limitation. Please wait for ",o="seconds for data to load",l="sorry, there doesn't seem to be data for @state",r="please wait a little bit more, your connection seems to be unstable...";return{noData:t,waitTime:s,waitFinished:i}}(jQuery);
var makeAjax=function(e){"use strict";function n(n){e.ajax({url:n,method:"GET",dataType:"json",success:function(e){request.cleanCode(e)},error:function(){log("fail to get code")}})}function t(n,o,c,i){if(console.log(a),i>=o.length||1===a)return console.log("all data has loaded"),notify.waitFinished(),i>=o.length&&(a=1,e(".js-search-btn").html("Search")),void(1===a&&e(".js-search-btn").html("Search"));setTimeout(function(){-1===i?(log("make sync request: initialize -1 to negate setTimeout effect"),i+=1,e.ajax({url:o[i+1],success:function(e){t(n,o,c,i),info.cleanData(n,e,c[i])},error:function(){log("initialize sync ajax failed: "+i),log("moving on to new ajax for next data:"),t(n,o,c,i)}})):(log("make sync request: "+i),e.ajax({url:o[i],method:"GET",dataType:"json",success:function(e){info.cleanData(n,e,c[i]),i+=1,t(n,o,c,i)},error:function(){log("load data failed: "+i+"for"+c[i]),log("moving on to new ajax for next data:"),i+=1,t(n,o,c,i)}}))},1e3)}var a=0;return function(){e(".js-search-location").submit(function(n){n.preventDefault(),1===a?a=0:(e(".js-search-btn").html("Search"),a=1)})}(),{sync:t,asyncGetCode:n}}(jQuery);
var info=function(e){"use strict";function a(e,a,r){log("cleanData");var t,n=a.dataset.data,i={house_prices:{1:1},HousePriceYr1:0 in n?n[0][1]:0,HousePriceYr3:2 in n?n[2][1]:0,HousePriceYr5:4 in n?n[4][1]:0,HousePriceYr10:9 in n?n[9][1]:0,PriceChangeYr1:percentChg(n[0][1],1 in n?n[0][1]:0),PriceChangeYr3:percentChg(n[0][1],2 in n?n[2][1]:0),PriceChangeYr5:percentChg(n[0][1],4 in n?n[4][1]:0),PriceChangeYr10:percentChg(n[0][1],9 in n?n[9][1]:0)};"All States"===e?(stateRepo.data[r]=i,t=stateRepo.data):(neighborhoodRepo.data[e][r]=i,t=neighborhoodRepo.data),info.buildInfo(e,t,r)}function r(e,a,r){var t,n="All States"===e?"":e,i=r+" "+n+" United States",o=["Place: @place <br>","@dataType: @displayData <br>","Average over: @time years"],c=ChosenDataType+"Yr"+CurrentTime,s="All States"===e?a:a[e],p=s[r][c],l=0===p?"no data":p.format(2,3,",",".");"HousePrice"===ChosenDataType&&(l="$"+l,t=p/100),"PriceChange"===ChosenDataType&&(l+="%",t=1e3*p),o=o.join("").replace("@place",r).replace("@dataType",ChosenDataType).replace("@displayData",l).replace("@time",CurrentTime),mark.buildMarkers(e,r,i,o,t)}return{buildInfo:r,cleanData:a}}(jQuery);
var request=function(o){"use strict";function e(e){if(log("getCode()"),o.support.cors=!0,"All States"===(d=e))return n="S",void(o.isEmptyObject(stateRepo.codes)?makeAjax.asyncGetCode("state_code.json"):a(n));n="N",log("get area codes"),o.isEmptyObject(neighborhoodRepo.codes)?makeAjax.asyncGetCode("neighborhood_code.json"):a(n)}function t(o){if(log("cleanCode()"),"All States"===d)return stateRepo.codes=o,log("this is "+stateRepo.codes),log(stateRepo.codes),void a(n);neighborhoodRepo.codes=o,log(neighborhoodRepo.codes);for(var e in neighborhoodRepo.codes){var t=neighborhoodRepo.codes[e]["City|Code"].split("|");neighborhoodRepo.codes[e].Code=t[1]}a(n)}function a(o){log("buildURL()");var e=["https://www.quandl.com/api/v3/datasets/ZILL/",o,"@areaCode_A.json?collapse=annual","&api_key=1aGVznRZH7ckoyhVtges"],t=[],a=[];if("All States"===d)for(var n in stateRepo.codes){var r=e.join("").replace("@areaCode",stateRepo.codes[n]);t.push(r),a.push(n)}else for(var i in neighborhoodRepo.codes){var c=abbrState(d,"abbr");if(neighborhoodRepo.codes[i].Metro===c){var p=e.join("").replace("@areaCode",neighborhoodRepo.codes[i].Code);t.push(p),a.push(i)}}s(t,a)}function s(o,e){if(log("makeRequest()"),0===o.length)return void notify.noData(d);notify.waitTime(o.length+10);makeAjax.sync(d,o,e,-1)}var d,n;return{getCode:e,cleanCode:t}}(jQuery);
var stateRepo=function(t){"use strict";function e(){if(log(e),t(".js-search-btn").html("Loading..."),t.isEmptyObject(s))request.getCode(r);else{log("state data already exists"),t(".js-search-btn").html("Search");for(var a in s)info.buildInfo(r,s,a)}}var a={},s={},r="All States";return{getState:e,codes:a,data:s}}(jQuery);
var neighborhoodRepo=function(e){"use strict";function o(r){if(log(o),e(".js-search-btn").html("Loading..."),t!==r&&(mark.moveToLocation(r),t=r),e.isEmptyObject(a[r]))a[r]={},request.getCode(t);else{log("area data already exists"),e(".js-search-btn").html("Search"),mark.removeMarkers();for(var i in a[r])info.buildInfo(r,a,i)}}var r={},a={},t="";return{getNeighborhood:o,codes:r,data:a}}(jQuery);
var CurrentTime=1,ChosenDataType="HousePrice";!function(e){"use strict";log("app loaded"),function(){e(".js-search-location").submit(function(t){t.preventDefault();var o=e("#js-state option:selected").val();if(ChosenDataType=e("#js-data-type option:selected").val(),CurrentTime=e("#js-year option:selected").val(),mark.removeMarkers(),notify.waitFinished(),"All States"===o)return void stateRepo.getState();neighborhoodRepo.getNeighborhood(o)})}(),gmap.init(),stateRepo.getState()}(jQuery);
var getData=function(e){"use strict";function a(a,r,o){if(void 0===a&&(a="All States"),void 0===r&&(r=1),void 0===o&&(o="HousePrice"),e(".js-search-btn").html("Loading..."),u!==a&&("All States"===a?mark.zoomOut():mark.moveToLocation(a),u=a),"All States"!==a||e.isEmptyObject(c))if(e.isEmptyObject(d[a]))t(a,r,o);else{log("area data already exists"),mark.removeMarkers();for(var i in d[a])info.buildInfo(a,d,i,r,o)}else{log("state data already exists");for(var n in c)info.buildInfo(a,c,n,r,o)}}function t(a,t,r){if(e.support.cors=!0,"All States"===a)return void(e.isEmptyObject(s)?makeAjax.asyncGetCode(a,"state_code.json",t,r):(n="S",o(a,n,t,r)));log("get area codes"),e.isEmptyObject(l)?makeAjax.asyncGetCode(a,"neighborhood_code.json",t,r):(n="N",o(a,n,t,r))}function r(e,a,t,r){if("All States"===e)return n="S",s=a,void o(e,n,t,r);n="N",l=a;for(var i in l){var c=l[i]["City|Code"].split("|");l[i].Code=c[1]}o(e,n,t,r)}function o(e,a,t,r){var o,i=["https://www.quandl.com/api/v3/datasets/ZILL/",a,"@areaCode_A.json?collapse=annual","&api_key=1aGVznRZH7ckoyhVtges"],n=[],c=[];if("All States"===e)for(var u in s)o=i.join("").replace("@areaCode",s[u]),n.push(o),c.push(u);else{for(var f in l){var p=abbrState(e,"abbr");l[f].Metro===p&&(o=i.join("").replace("@areaCode",l[f].Code),n.push(o),c.push(f))}d[e]={}}if(0===n.length)return void notify.noData(e);notify.waitTime(n.length+10);makeAjax.sync(e,n,c,-1,t,r)}function i(e,a,t,r,o){var i,n=a.dataset.data,s={house_prices:{1:1},HousePriceYr1:0 in n?n[0][1]:0,HousePriceYr3:2 in n?n[2][1]:0,HousePriceYr5:4 in n?n[4][1]:0,HousePriceYr10:9 in n?n[9][1]:0,PriceChangeYr1:percentChg(n[0][1],1 in n?n[0][1]:0),PriceChangeYr3:percentChg(n[0][1],2 in n?n[2][1]:0),PriceChangeYr5:percentChg(n[0][1],4 in n?n[4][1]:0),PriceChangeYr10:percentChg(n[0][1],9 in n?n[9][1]:0)};"All States"===e?(c[t]=s,i=c):(d[e][t]=s,i=d),info.buildInfo(e,i,t,r,o)}var n,s={},c={},l={},d={},u="All States";return{from:a,cleanAreaCode:r,cleanData:i}}(jQuery);