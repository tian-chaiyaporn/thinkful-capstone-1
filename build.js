var CurrentTime=1,ChosenDataType="HousePrice",debug=!0,log=function(e){debug&&console.log(e)},storageAvailable=function(e){try{var a=window[e],n="__storage_test__";return a.setItem(n,n),a.removeItem(n),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&0!==a.length}},percentChg=function(e,a){return 0!==a?(e-a)/(e+a)*100:0};Number.prototype.format=function(e,a,n,i){var r="\\d(?=(\\d{"+(a||3)+"})+"+(e>0?"\\D":"$")+")",o=this.toFixed(Math.max(0,~~e));return(i?o.replace(".",i):o).replace(new RegExp(r,"g"),"$&"+(n||","))};var abbrState=function(e,a){var n=[["Arizona","AZ"],["Alabama","AL"],["Alaska","AK"],["Arizona","AZ"],["Arkansas","AR"],["California","CA"],["Colorado","CO"],["Connecticut","CT"],["Delaware","DE"],["Florida","FL"],["Georgia","GA"],["Hawaii","HI"],["Idaho","ID"],["Illinois","IL"],["Indiana","IN"],["Iowa","IA"],["Kansas","KS"],["Kentucky","KY"],["Kentucky","KY"],["Louisiana","LA"],["Maine","ME"],["Maryland","MD"],["Massachusetts","MA"],["Michigan","MI"],["Minnesota","MN"],["Mississippi","MS"],["Missouri","MO"],["Montana","MT"],["Nebraska","NE"],["Nevada","NV"],["New Hampshire","NH"],["New Jersey","NJ"],["New Mexico","NM"],["New York","NY"],["North Carolina","NC"],["North Dakota","ND"],["Ohio","OH"],["Oklahoma","OK"],["Oregon","OR"],["Pennsylvania","PA"],["Rhode Island","RI"],["South Carolina","SC"],["South Dakota","SD"],["Tennessee","TN"],["Texas","TX"],["Utah","UT"],["Vermont","VT"],["Virginia","VA"],["Washington","WA"],["West Virginia","WV"],["Wisconsin","WI"],["Wyoming","WY"]];if("abbr"==a){for(e=e.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}),i=0;i<n.length;i++)if(n[i][0]==e)return n[i][1]}else if("name"==a)for(e=e.toUpperCase(),i=0;i<n.length;i++)if(n[i][1]==e)return n[i][0]};
var map,gmap=function(e){"use strict";function t(){log("gmap.init() loaded"),s.mapcanvas=e(".js-gmap"),s.mapcanvas.length?o():log("gmap.init(): no mapcanvas found")}function o(){var e=document.createElement("script");e.type="text/javascript",e.id="new-gmap",e.src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAF1sRGF7ku7L3dKictevzxUTPWc2YF6NI&callback=gmap.build",document.body.appendChild(e)}function l(){var t=e.extend({},s.mapDefaults,{zoom:s.zoom,center:new google.maps.LatLng(s.latCenter,s.lonCenter),zoomControlOptions:{position:google.maps.ControlPosition.LEFT_CENTER},maxZoom:s.maxZoom,minZoom:s.minZoom,styles:[{elementType:"geometry",stylers:[{color:"#212121"}]},{elementType:"labels.icon",stylers:[{visibility:"off"}]},{elementType:"labels.text.fill",stylers:[{color:"#757575"}]},{elementType:"labels.text.stroke",stylers:[{color:"#212121"}]},{featureType:"administrative",elementType:"geometry",stylers:[{color:"#757575"}]},{featureType:"administrative.country",elementType:"labels.text.fill",stylers:[{color:"#9e9e9e"}]},{featureType:"administrative.land_parcel",stylers:[{visibility:"off"}]},{featureType:"administrative.locality",elementType:"labels.text.fill",stylers:[{color:"#bdbdbd"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#757575"}]},{featureType:"poi.business",stylers:[{visibility:"off"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#181818"}]},{featureType:"poi.park",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#616161"}]},{featureType:"poi.park",elementType:"labels.text.stroke",stylers:[{color:"#1b1b1b"}]},{featureType:"road",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"geometry.fill",stylers:[{color:"#2c2c2c"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#8a8a8a"}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{color:"#373737"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#3c3c3c"}]},{featureType:"road.highway.controlled_access",elementType:"geometry",stylers:[{color:"#4e4e4e"}]},{featureType:"road.local",elementType:"labels.text.fill",stylers:[{color:"#616161"}]},{featureType:"transit",elementType:"labels.text.fill",stylers:[{color:"#757575"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#000000"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#3d3d3d"}]}]});map=new google.maps.Map(s.mapcanvas[0],t)}function a(){var e=new google.maps.LatLng(37.09024,-96.712891);map.panTo(e),map.setZoom(4)}function r(t){if(log("moveToLocation()"),e.isEmptyObject(Coordinates[t])){var o=t+" United States";getLatLng(o,t,function(){r(t)})}else{var l=new google.maps.LatLng(Coordinates[t][0],Coordinates[t][1]);map.panTo(l),map.setZoom(6)}}var s={mapDefaults:{panControl:!1,zoomControl:!0,zoomControlOptions:!0,scaleControl:!1,mapTypeControl:!1,streetViewControl:!1,scrollwheel:!1,zoom:4,maxZoom:16,minZoom:3},mapcanvas:0,latCenter:37.09024,lonCenter:-96.712891};return{init:t,build:l,zoomOut:a,moveToLocation:r}}(jQuery);
var mark=function(o){"use strict";function n(){s.map(function(o){o.infowindow.close()})}var e,t,i,a,r,l=[],s=[],c=function(){return new Promise(function(o,n){if(l.hasOwnProperty(t))return s.find(function(o){return o.title===t}).infowindow.setContent(a),void n("markers already exists");o()})},g=function(){return new Promise(function(o,n){var e=new google.maps.Geocoder,a=[];e.geocode({address:i},function(e,i){if(i!=google.maps.GeocoderStatus.OK)return void n("cannot find geocode");a[0]=e[0].geometry.location.lat(),a[1]=e[0].geometry.location.lng(),l[t]=a,o(a)})})},m=function(o){log("displayMarker()");var i=new google.maps.InfoWindow({content:a}),l=100,c="red";if("All States"!==e){var g=new google.maps.LatLng(o[0],o[1]);map.panTo(g),map.setZoom(8),l=500,c="yellow"}var m={path:google.maps.SymbolPath.CIRCLE,fillColor:c,fillOpacity:.6,scaledSize:new google.maps.Size(r,r),scale:r/l+4,strokeColor:"white",strokeWeight:0},u=new google.maps.Marker({position:{lat:o[0],lng:o[1]},icon:m,map:map,title:t,infowindow:i});u.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){u.setAnimation(null)},400),s.push(u),google.maps.event.addListener(u,"click",function(){n(),this.infowindow.open(map,this)})};return{buildMarkers:function(o,n,l,s,u){e=o,t=n,i=l,a=s,r=u,c().then(g).then(m).catch(function(o){log(o)})},removeMarkers:n}}(jQuery);
var notify=function(e){"use strict";function t(t){e(".js-notify-message").html(l.replace("@state",t)),e(".js-notify-timer").html(""),e(".js-notify-message-last").html(""),e(".js-notify").removeClass("slideOutDown"),e(".js-notify").addClass("slideInUp")}function s(t){e(".js-notify-message").html(a),n(t),e(".js-notify-message-last").html(o),e(".js-notify").removeClass("slideOutDown"),e(".js-notify").addClass("slideInUp")}function n(t){var s=t,n=document.getElementById("countdowntimer"),i=setInterval(function(){s--,n.classList.add("flipInX"),n.innerHTML=s,setTimeout(function(){n.classList.remove("flipInX")},980),e(".js-search-location").submit(function(e){e.preventDefault(),clearInterval(i)}),s<=0&&(e(".js-notify-message").html(""),clearInterval(i),n.innerHTML="sorry",e(".js-notify-message-last").html(r))},1e3)}function i(){e(".js-notify").removeClass("slideInUp"),e(".js-notify").addClass("slideOutDown")}var a="Because this is a free service there is an API limitation. Please wait for ",o="seconds for data to load",l="sorry, there doesn't seem to be data for @state",r="please wait a little bit more, your connection seems to be unstable...";return{noData:t,waitTime:s,waitFinished:i}}(jQuery);
var makeAjax=function(n){"use strict";function o(e,a,c,s){return console.log(t),1===t?(console.log("download stopped"),notify.waitFinished(),void n(".js-search-btn").html("Search")):s>=a.length?(console.log("all data has loaded"),notify.waitFinished(),t=1,void n(".js-search-btn").html("Search")):void setTimeout(function(){log("make sync request: "+s),n.ajax({url:a[s],method:"GET",dataType:"json",success:function(n){info.cleanData(e,n,c[s]),s+=1,o(e,a,c,s)},error:function(){log("load data failed for: "+c[s]+" moving on to new ajax for next data."),s+=1,o(e,a,c,s)}})},1e3)}var e=function(o){return new Promise(function(e,t){n.ajax({url:o,method:"GET",dataType:"json",success:function(n){e(n)},error:function(){t("fail to get code")}})})},t=0;return function(){n(".js-search-location").submit(function(o){o.preventDefault(),1===t?t=0:(n(".js-search-btn").html("Search"),t=1)})}(),{sync:o,asyncGetCode:e}}(jQuery);
var info=function(e){"use strict";function a(e,a,r){log("cleanData");var t,n=a.dataset.data,i={house_prices:{1:1},HousePriceYr1:0 in n?n[0][1]:0,HousePriceYr3:2 in n?n[2][1]:0,HousePriceYr5:4 in n?n[4][1]:0,HousePriceYr10:9 in n?n[9][1]:0,PriceChangeYr1:percentChg(n[0][1],1 in n?n[1][1]:0),PriceChangeYr3:percentChg(n[0][1],2 in n?n[2][1]:0),PriceChangeYr5:percentChg(n[0][1],4 in n?n[4][1]:0),PriceChangeYr10:percentChg(n[0][1],9 in n?n[9][1]:0)};"All States"===e?(stateRepo.data[r]=i,t=stateRepo.data):(neighborhoodRepo.data[e][r]=i,t=neighborhoodRepo.data),info.buildInfo(e,t,r)}function r(e,a,r){var t,n="All States"===e?"":e,i=r+" "+n+" United States",o=["Place: @place <br>","@dataType: @displayData <br>","Average over: @time years"],c=ChosenDataType+"Yr"+CurrentTime,s="All States"===e?a:a[e],p=s[r][c],l=0===p?"no data":p.format(2,3,",",".");"HousePrice"===ChosenDataType&&(l="$"+l,t=p/100),"PriceChange"===ChosenDataType&&(l+="%",t=1e3*p),o=o.join("").replace("@place",r).replace("@dataType",ChosenDataType).replace("@displayData",l).replace("@time",CurrentTime),mark.buildMarkers(e,r,i,o,t)}return{buildInfo:r,cleanData:a}}(jQuery);
var request=function(e){"use strict";var o,r=function(){return new Promise(function(r,n){if(log("getCode()"),e.support.cors=!0,"All States"===o)return void r("state_code.json");r("neighborhood_code.json")})},n=function(e){return log("cleanCode()"),new Promise(function(r,n){var t;if("All States"===o)return stateRepo.codes=e,t="S",void r(t);neighborhoodRepo.codes=e;for(var a in neighborhoodRepo.codes){var i=neighborhoodRepo.codes[a]["City|Code"].split("|");neighborhoodRepo.codes[a].Code=i[1]}t="N",r(t)})},t=function(e){return log("buildURL()"),new Promise(function(r,n){var t=["https://www.quandl.com/api/v3/datasets/ZILL/",e,"@areaCode_A.json?collapse=annual","&api_key=1aGVznRZH7ckoyhVtges"],a=[],i=[];if("S"===e)for(var s in stateRepo.codes){var d=t.join("").replace("@areaCode",stateRepo.codes[s]);a.push(d),i.push(s)}else for(var c in neighborhoodRepo.codes){var u=abbrState(o,"abbr");if(neighborhoodRepo.codes[c].Metro===u){var h=t.join("").replace("@areaCode",neighborhoodRepo.codes[c].Code);a.push(h),i.push(c)}}r({urlArray:a,nameArray:i})})},a=function(e){if(log("makeRequest()"),0===e.urlArray.length)return void notify.noData(o);notify.waitTime(e.urlArray.length+10);makeAjax.sync(o,e.urlArray,e.nameArray,0)};return{getData:function(e){o=e,r(o).then(makeAjax.asyncGetCode).then(n).then(t).then(a).catch(function(e){log(e)})}}}(jQuery);
var stateRepo=function(t){"use strict";function e(){return log("getState()"),t(".js-search-btn").html("Loading..."),new Promise(function(e,a){if(t.isEmptyObject(i)){if(localStorage.getItem("stateData")){var r=localStorage.getItem("stateData");return i=JSON.parse(r),void e(i)}return request.getData(n),void a("data is being called and markers displayed immediately after")}return log("state data already exists"),t(".js-search-btn").html("Search"),void e(i)})}function a(t){for(var e in t)info.buildInfo(n,t,e)}var r={},i={},n="All States";return{getState:e,buildInterface:a,codes:r,data:i}}(jQuery);
var neighborhoodRepo=function(e){"use strict";function a(a){return log("getNeighborhood()"),e(".js-search-btn").html("Loading..."),new Promise(function(r,o){if(i!==a&&(gmap.moveToLocation(a),i=a),e.isEmptyObject(t[a])){if(localStorage.getItem("neighborhoodData")){var n=localStorage.getItem("neighborhoodData");return t=JSON.parse(n),void r(t)}return t[a]={},request.getData(i),void rej("data is being called and markers displayed immediately after")}return log("area data already exists"),e(".js-search-btn").html("Search"),mark.removeMarkers(),void r(t[a])})}function r(e){for(var a in e)info.buildInfo(i,e,state)}var o={},t={},i="";return{getNeighborhood:a,buildInterface:r,codes:o,data:t}}(jQuery);
!function(e){"use strict";log("app loaded"),function(){e(".js-search-location").submit(function(t){t.preventDefault();var o=e("#js-state option:selected").val();if(ChosenDataType=e("#js-data-type option:selected").val(),CurrentTime=e("#js-year option:selected").val(),mark.removeMarkers(),notify.waitFinished(),"All States"===o)return gmap.zoomOut(),void stateRepo.getState().then(stateRepo.buildInterface).catch(function(e){log(e)});neighborhoodRepo.getNeighborhood(o).then(neighborhoodRepo.buildInterface).catch(function(e){log(e)})})}(),gmap.init(),stateRepo.getState().then(stateRepo.buildInterface).catch(function(e){log(e)})}(jQuery);