var debug=!0,log=function(e){debug&&console.log(e)},percentChg=function(e,r){return 0!==r?(e-r)/(e+r)*100:0};Number.prototype.format=function(e,r,t,n){var o="\\d(?=(\\d{"+(r||3)+"})+"+(e>0?"\\D":"$")+")",u=this.toFixed(Math.max(0,~~e));return(n?u.replace(".",n):u).replace(new RegExp(o,"g"),"$&"+(t||","))};
var map,gmap=function(o){"use strict";function n(){log("gmap.init() loaded"),l.mapcanvas=o(".js-gmap"),l.mapcanvas.length?a():log("gmap.init(): no mapcanvas found")}function a(){var o=document.createElement("script");o.type="text/javascript",o.id="new-gmap",o.src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAF1sRGF7ku7L3dKictevzxUTPWc2YF6NI&callback=gmap.build",document.body.appendChild(o)}function e(){var n=o.extend({},l.mapDefaults,{zoom:l.zoom,center:new google.maps.LatLng(l.latCenter,l.lonCenter),zoomControlOptions:{position:google.maps.ControlPosition.LEFT_CENTER},maxZoom:l.maxZoom,minZoom:l.minZoom,styles:[]});map=new google.maps.Map(l.mapcanvas[0],n)}function t(o,n,a){var e=new google.maps.Geocoder,t=[];e.geocode({address:n},function(n,e){e==google.maps.GeocoderStatus.OK&&(t[0]=n[0].geometry.location.lat(),t[1]=n[0].geometry.location.lng(),p[o]=t,m(t,o,a))})}function m(o,n,a){var e=new google.maps.InfoWindow({content:a}),t=new google.maps.Marker({position:{lat:o[0],lng:o[1]},map:map,title:n,infowindow:e});s.push(t),google.maps.event.addListener(t,"click",function(){i(),this.infowindow.open(map,this)})}function i(){s.map(function(o){o.infowindow.close()})}var l={mapDefaults:{panControl:!1,zoomControl:!0,zoomControlOptions:!0,scaleControl:!1,mapTypeControl:!1,streetViewControl:!1,scrollwheel:!1,zoom:4,maxZoom:16,minZoom:3},mapcanvas:0,latCenter:37.09024,lonCenter:-96.712891},p=[],s=[];return{init:n,build:e,buildMarkers:t,removeMarkers:i}}(jQuery);
var makeAjax=function(t){"use strict";function a(e,c,n,s,o){n>=3||setTimeout(function(){-1===n?(log("make sync request: initialize -1 to negate setTimeout effect"),n+=1,t.ajax({url:e[n+1],success:function(t){a(e,c,n,s,o),log(t),"S"===t.dataset.dataset_code.charAt(0)&&getStateData.cleanStateData(t,c[n],s,o)}})):(log("make sync request: "+n),t.ajax({url:e[n],method:"GET",dataType:"json",success:function(t){n+=1,a(e,c,n,s,o),"S"===t.dataset.dataset_code.charAt(0)&&getStateData.cleanStateData(t,c[n],s,o)},error:function(){log("state data failed: "+n)}}))},1e3)}return{sync:a}}(jQuery);
var getStateData=function(e){"use strict";function a(e,a,r){void 0===e&&(e="All States"),void 0===a&&(a=10),void 0===r&&(r="HousePrice"),t(a,r)}function t(a,t){e.support.cors=!0,e.isEmptyObject(s)?e.ajax({url:"state_code.json",method:"GET",dataType:"json",success:function(e){r(e,a,t)},error:function(){log("csv failed refreshed 2")}}):r(s,a,t)}function r(a,t,r){if(e.isEmptyObject(c)){s=a;var i=[],o=[];for(var p in s){var u="https://www.quandl.com/api/v3/datasets/ZILL/S@stateCode_A.json?collapse=annual&api_key=1aGVznRZH7ckoyhVtges".replace("@stateCode",s[p]);i.push(u),o.push(p)}makeAjax.sync(i,o,-1,t,r)}else{log("state data already exists"),log(t+r);for(var d in c)n(c,d,t,r)}}function i(e,a,t,r){var i=e.dataset.data;c[a]={HousePriceYr1:i[0][1],HousePriceYr3:2 in i?i[2][1]:0,HousePriceYr5:4 in i?i[4][1]:0,HousePriceYr10:9 in i?i[9][1]:0,PriceChangeYr1:percentChg(i[0][1],i[1][1]),PriceChangeYr3:percentChg(i[0][1],2 in i?i[2][1]:0),PriceChangeYr5:percentChg(i[0][1],4 in i?i[4][1]:0),PriceChangeYr10:percentChg(i[0][1],9 in i?i[9][1]:0)},n(c,a,t,r)}function n(e,a,t,r){var i=a+" "+a+" United States",n=["State: @state <br>","@dataType: @displayData <br>","Data over: @time years"],s=r+"Yr"+t;s=e[a][s].format(0,3,","),"HousePrice"===r?s="$"+s:s+="%",n=n.join("").replace("@state",a).replace("@dataType",r).replace("@displayData",s).replace("@time",t),gmap.buildMarkers(a,i,n)}var s={},c={};return{from:a,cleanStateData:i}}(jQuery);
var getAreaData=function(e){"use strict";function a(e,a,r){void 0===e&&(e="All States"),void 0===a&&(a=10),void 0===r&&(r="HousePrice"),t(a,r)}function t(a,t){e.support.cors=!0,e.isEmptyObject(s)?e.ajax({url:"state_code.json",method:"GET",dataType:"json",success:function(e){r(e,a,t)},error:function(){log("csv failed refreshed 2")}}):r(s,a,t)}function r(a,t,r){if(e.isEmptyObject(c)){s=a;var i=[],o=[];for(var p in s){var u="https://www.quandl.com/api/v3/datasets/ZILL/S@stateCode_A.json?collapse=annual&api_key=1aGVznRZH7ckoyhVtges".replace("@stateCode",s[p]);i.push(u),o.push(p)}makeAjax.sync(i,o,-1,t,r)}else{log("state data already exists"),log(t+r);for(var d in c)n(c,d,t,r)}}function i(e,a,t,r){var i=e.dataset.data;c[a]={HousePriceYr1:i[0][1],HousePriceYr3:2 in i?i[2][1]:0,HousePriceYr5:4 in i?i[4][1]:0,HousePriceYr10:9 in i?i[9][1]:0,PriceChangeYr1:percentChg(i[0][1],i[1][1]),PriceChangeYr3:percentChg(i[0][1],2 in i?i[2][1]:0),PriceChangeYr5:percentChg(i[0][1],4 in i?i[4][1]:0),PriceChangeYr10:percentChg(i[0][1],9 in i?i[9][1]:0)},n(c,a,t,r)}function n(e,a,t,r){var i=a+" "+a+" United States",n=["State: @state <br>","@dataType: @displayData <br>","Data over: @time years"],s=r+"Yr"+t;s=e[a][s].format(0,3,","),"HousePrice"===r?s="$"+s:s+="%",n=n.join("").replace("@state",a).replace("@dataType",r).replace("@displayData",s).replace("@time",t),gmap.buildMarkers(a,i,n)}var s={},c={};return{from:a,cleanStateData:i}}(jQuery);
!function(t){"use strict";log("app loaded"),function(){t(".js-search-location").submit(function(e){e.preventDefault();var a=t("#js-data-type option:selected").val(),o=t("#js-year option:selected").val(),s=t("#js-state option:selected").val();gmap.removeMarkers(),"All States"===s?getStateData.from(s,o,a):getAreaData.from(s,o,a)})}(),gmap.init(),getStateData.from("All States")}(jQuery);