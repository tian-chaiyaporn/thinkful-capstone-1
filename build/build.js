var debug=!0,log=function(a){debug&&console.log(a)},percentChg=function(a,e){return 0!==e?(a-e)/(a+e)*100:0};Number.prototype.format=function(a,e,i,n){var o="\\d(?=(\\d{"+(e||3)+"})+"+(a>0?"\\D":"$")+")",r=this.toFixed(Math.max(0,~~a));return(n?r.replace(".",n):r).replace(new RegExp(o,"g"),"$&"+(i||","))};var abbrState=function(a,e){var n=[["Arizona","AZ"],["Alabama","AL"],["Alaska","AK"],["Arizona","AZ"],["Arkansas","AR"],["California","CA"],["Colorado","CO"],["Connecticut","CT"],["Delaware","DE"],["Florida","FL"],["Georgia","GA"],["Hawaii","HI"],["Idaho","ID"],["Illinois","IL"],["Indiana","IN"],["Iowa","IA"],["Kansas","KS"],["Kentucky","KY"],["Kentucky","KY"],["Louisiana","LA"],["Maine","ME"],["Maryland","MD"],["Massachusetts","MA"],["Michigan","MI"],["Minnesota","MN"],["Mississippi","MS"],["Missouri","MO"],["Montana","MT"],["Nebraska","NE"],["Nevada","NV"],["New Hampshire","NH"],["New Jersey","NJ"],["New Mexico","NM"],["New York","NY"],["North Carolina","NC"],["North Dakota","ND"],["Ohio","OH"],["Oklahoma","OK"],["Oregon","OR"],["Pennsylvania","PA"],["Rhode Island","RI"],["South Carolina","SC"],["South Dakota","SD"],["Tennessee","TN"],["Texas","TX"],["Utah","UT"],["Vermont","VT"],["Virginia","VA"],["Washington","WA"],["West Virginia","WV"],["Wisconsin","WI"],["Wyoming","WY"]];if("abbr"==e){for(a=a.replace(/\w\S*/g,function(a){return a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()}),i=0;i<n.length;i++)if(n[i][0]==a)return n[i][1]}else if("name"==e)for(a=a.toUpperCase(),i=0;i<n.length;i++)if(n[i][1]==a)return n[i][0]};
var map,gmap=function(e){"use strict";function t(){log("gmap.init() loaded"),a.mapcanvas=e(".js-gmap"),a.mapcanvas.length?l():log("gmap.init(): no mapcanvas found")}function l(){var e=document.createElement("script");e.type="text/javascript",e.id="new-gmap",e.src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAF1sRGF7ku7L3dKictevzxUTPWc2YF6NI&callback=gmap.build",document.body.appendChild(e)}function o(){var t=e.extend({},a.mapDefaults,{zoom:a.zoom,center:new google.maps.LatLng(a.latCenter,a.lonCenter),zoomControlOptions:{position:google.maps.ControlPosition.LEFT_CENTER},maxZoom:a.maxZoom,minZoom:a.minZoom,styles:[{elementType:"geometry",stylers:[{color:"#212121"}]},{elementType:"labels.icon",stylers:[{visibility:"off"}]},{elementType:"labels.text.fill",stylers:[{color:"#757575"}]},{elementType:"labels.text.stroke",stylers:[{color:"#212121"}]},{featureType:"administrative",elementType:"geometry",stylers:[{color:"#757575"}]},{featureType:"administrative.country",elementType:"labels.text.fill",stylers:[{color:"#9e9e9e"}]},{featureType:"administrative.land_parcel",stylers:[{visibility:"off"}]},{featureType:"administrative.locality",elementType:"labels.text.fill",stylers:[{color:"#bdbdbd"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#757575"}]},{featureType:"poi.business",stylers:[{visibility:"off"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#181818"}]},{featureType:"poi.park",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#616161"}]},{featureType:"poi.park",elementType:"labels.text.stroke",stylers:[{color:"#1b1b1b"}]},{featureType:"road",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"geometry.fill",stylers:[{color:"#2c2c2c"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#8a8a8a"}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{color:"#373737"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#3c3c3c"}]},{featureType:"road.highway.controlled_access",elementType:"geometry",stylers:[{color:"#4e4e4e"}]},{featureType:"road.local",elementType:"labels.text.fill",stylers:[{color:"#616161"}]},{featureType:"transit",elementType:"labels.text.fill",stylers:[{color:"#757575"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#000000"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#3d3d3d"}]}]});map=new google.maps.Map(a.mapcanvas[0],t)}var a={mapDefaults:{panControl:!1,zoomControl:!0,zoomControlOptions:!0,scaleControl:!1,mapTypeControl:!1,streetViewControl:!1,scrollwheel:!1,zoom:4,maxZoom:16,minZoom:3},mapcanvas:0,latCenter:37.09024,lonCenter:-96.712891};return{init:t,build:o}}(jQuery);
var mark=function(o){"use strict";function e(e,t,a,i,m){if(!o.isEmptyObject(s[t]))return void l.find(function(o){return o.title===t}).infowindow.setContent(i);var r=new google.maps.Geocoder,g=[];r.geocode({address:a},function(o,a){a==google.maps.GeocoderStatus.OK&&(g[0]=o[0].geometry.location.lat(),g[1]=o[0].geometry.location.lng(),s[t]=g,n(e,g,t,i,m))})}function n(o,e,n,a,i){var s=new google.maps.InfoWindow({content:a}),m=100,r="red";if("All States"!==o){var g=new google.maps.LatLng(e[0],e[1]);map.panTo(g),map.setZoom(8),m=500,r="yellow"}var c={path:google.maps.SymbolPath.CIRCLE,fillColor:r,fillOpacity:.6,scaledSize:new google.maps.Size(i,i),scale:i/m+4,strokeColor:"white",strokeWeight:0},p=new google.maps.Marker({position:{lat:e[0],lng:e[1]},icon:c,map:map,title:n,infowindow:s});p.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){p.setAnimation(null)},400),l.push(p),google.maps.event.addListener(p,"click",function(){t(),this.infowindow.open(map,this)})}function t(){l.map(function(o){o.infowindow.close()})}function a(e){if(o.isEmptyObject(s[e])){var n=new google.maps.Geocoder,t=[];n.geocode({address:e+" United States"},function(o,n){n==google.maps.GeocoderStatus.OK&&(t[0]=o[0].geometry.location.lat(),t[1]=o[0].geometry.location.lng(),s[e]=t)})}var a=s[e][0],i=s[e][1],l=new google.maps.LatLng(a,i);map.panTo(l),map.setZoom(6)}function i(){var o=new google.maps.LatLng(37.09024,-96.712891);map.panTo(o),map.setZoom(4)}var s=[],l=[];return{buildMarkers:e,removeMarkers:t,moveToLocation:a,zoomOut:i}}(jQuery);
var notify=function(e){"use strict";function t(t){e(".js-notify-message").html(l.replace("@state",t)),e(".js-notify-timer").html(""),e(".js-notify-message-last").html(""),e(".js-notify").removeClass("slideOutDown"),e(".js-notify").addClass("slideInUp")}function s(t){e(".js-notify-message").html(a.join("")),n(t),e(".js-notify-message-last").html(o),e(".js-notify").removeClass("slideOutDown"),e(".js-notify").addClass("slideInUp")}function n(t){var s=t,n=document.getElementById("countdowntimer"),i=setInterval(function(){s--,n.classList.add("flipInX"),n.innerHTML=s,setTimeout(function(){n.classList.remove("flipInX")},980),e(".js-search-location").submit(function(e){e.preventDefault(),clearInterval(i)}),s<=0&&(e(".js-notify-message").html(""),clearInterval(i),n.innerHTML="sorry",e(".js-notify-message-last").html("please wait a little bit more, your connection seems to be unstable..."))},1e3)}function i(){e(".js-notify").removeClass("slideInUp"),e(".js-notify").addClass("slideOutDown")}var a=["Because this is a free service. ","There is an API limitation, please wait for "],o=" seconds for data to load",l="sorry, there doesn't seem to be data for @state";return{noData:t,waitTime:s,waitFinished:i}}(jQuery);
var makeAjax=function(e){"use strict";function a(a,t,n,o){e.ajax({url:t,method:"GET",dataType:"json",success:function(e){getData.cleanAreaCode(a,e,n,o)},error:function(){log("fail to get code")}})}function t(a,o,c,i,s,r){if(console.log(n),i>=o.length||1===n)return console.log("all data has loaded"),notify.waitFinished(),i>=o.length&&(n=1,e(".js-search-btn").html("Search")),void(1===n&&e(".js-search-btn").html("Search"));setTimeout(function(){-1===i?(log("make sync request: initialize -1 to negate setTimeout effect"),i+=1,e.ajax({url:o[i+1],success:function(e){t(a,o,c,i,s,r),getData.cleanData(a,e,c[i],s,r)},error:function(){log("initialize sync ajax failed: "+i),log("moving on to new ajax for next data:"),t(a,o,c,i,s,r)}})):(log("make sync request: "+i),e.ajax({url:o[i],method:"GET",dataType:"json",success:function(e){getData.cleanData(a,e,c[i],s,r),i+=1,t(a,o,c,i,s,r)},error:function(){log("load data failed: "+i+"for"+c[i]),log("moving on to new ajax for next data:"),i+=1,t(a,o,c,i,s,r)}}))},1e3)}var n=0;return function(){e(".js-search-location").submit(function(a){a.preventDefault(),1===n?n=0:(e(".js-search-btn").html("Search"),n=1)})}(),{sync:t,asyncGetCode:a}}(jQuery);
var info=function(e){"use strict";function a(e,a,r,t,l){var i,c="All States"===e?"":e,n=r+" "+c+" United States",p=["Place: @place <br>","@dataType: @displayData <br>","Average over: @time years"],s=l+"Yr"+t,o="All States"===e?a:a[e],d=o[r][s],u=0===d?"no data":d.format(2,3,",",".");"HousePrice"===l&&(u="$"+u,i=d/100),"PriceChange"===l&&(u+="%",i=1e4*d),p=p.join("").replace("@place",r).replace("@dataType",l).replace("@displayData",u).replace("@time",t),mark.buildMarkers(e,r,n,p,i)}return{buildInfo:a}}(jQuery);
var getData=function(e){"use strict";function a(a,r,o){if(void 0===a&&(a="All States"),void 0===r&&(r=1),void 0===o&&(o="HousePrice"),e(".js-search-btn").html("Loading..."),u!==a&&("All States"===a?mark.zoomOut():mark.moveToLocation(a),u=a),"All States"!==a||e.isEmptyObject(c))if(e.isEmptyObject(d[a]))t(a,r,o);else{log("area data already exists"),mark.removeMarkers();for(var i in d[a])info.buildInfo(a,d,i,r,o)}else{log("state data already exists");for(var n in c)info.buildInfo(a,c,n,r,o)}}function t(a,t,r){if(e.support.cors=!0,"All States"===a)return void(e.isEmptyObject(s)?makeAjax.asyncGetCode(a,"state_code.json",t,r):(n="S",o(a,n,t,r)));log("get area codes"),e.isEmptyObject(l)?makeAjax.asyncGetCode(a,"neighborhood_code.json",t,r):(n="N",o(a,n,t,r))}function r(e,a,t,r){if("All States"===e)return n="S",s=a,void o(e,n,t,r);n="N",l=a;for(var i in l){var c=l[i]["City|Code"].split("|");l[i].Code=c[1]}o(e,n,t,r)}function o(e,a,t,r){var o,i=["https://www.quandl.com/api/v3/datasets/ZILL/",a,"@areaCode_A.json?collapse=annual","&api_key=1aGVznRZH7ckoyhVtges"],n=[],c=[];if("All States"===e)for(var u in s)o=i.join("").replace("@areaCode",s[u]),n.push(o),c.push(u);else{for(var f in l){var p=abbrState(e,"abbr");l[f].Metro===p&&(o=i.join("").replace("@areaCode",l[f].Code),n.push(o),c.push(f))}d[e]={}}if(0===n.length)return void notify.noData(e);notify.waitTime(n.length+10);makeAjax.sync(e,n,c,-1,t,r)}function i(e,a,t,r,o){var i,n=a.dataset.data,s={HousePriceYr1:0 in n?n[0][1]:0,HousePriceYr3:2 in n?n[2][1]:0,HousePriceYr5:4 in n?n[4][1]:0,HousePriceYr10:9 in n?n[9][1]:0,PriceChangeYr1:percentChg(n[0][1],1 in n?n[0][1]:0),PriceChangeYr3:percentChg(n[0][1],2 in n?n[2][1]:0),PriceChangeYr5:percentChg(n[0][1],4 in n?n[4][1]:0),PriceChangeYr10:percentChg(n[0][1],9 in n?n[9][1]:0)};"All States"===e?(c[t]=s,i=c):(d[e][t]=s,i=d),info.buildInfo(e,i,t,r,o)}var n,s={},c={},l={},d={},u="All States";return{from:a,cleanAreaCode:r,cleanData:i}}(jQuery);
!function(t){"use strict";log("app loaded"),function(){t(".js-search-location").submit(function(e){e.preventDefault();var a=t("#js-data-type option:selected").val(),o=t("#js-year option:selected").val(),i=t("#js-state option:selected").val();mark.removeMarkers(),notify.waitFinished(),getData.from(i,o,a)})}(),gmap.init(),getData.from("All States")}(jQuery);