var debug=!0,log=function(a){debug&&console.log(a)},percentChg=function(a,e){return 0!==e?(a-e)/(a+e)*100:0};Number.prototype.format=function(a,e,i,n){var o="\\d(?=(\\d{"+(e||3)+"})+"+(a>0?"\\D":"$")+")",r=this.toFixed(Math.max(0,~~a));return(n?r.replace(".",n):r).replace(new RegExp(o,"g"),"$&"+(i||","))};var abbrState=function(a,e){var n=[["Arizona","AZ"],["Alabama","AL"],["Alaska","AK"],["Arizona","AZ"],["Arkansas","AR"],["California","CA"],["Colorado","CO"],["Connecticut","CT"],["Delaware","DE"],["Florida","FL"],["Georgia","GA"],["Hawaii","HI"],["Idaho","ID"],["Illinois","IL"],["Indiana","IN"],["Iowa","IA"],["Kansas","KS"],["Kentucky","KY"],["Kentucky","KY"],["Louisiana","LA"],["Maine","ME"],["Maryland","MD"],["Massachusetts","MA"],["Michigan","MI"],["Minnesota","MN"],["Mississippi","MS"],["Missouri","MO"],["Montana","MT"],["Nebraska","NE"],["Nevada","NV"],["New Hampshire","NH"],["New Jersey","NJ"],["New Mexico","NM"],["New York","NY"],["North Carolina","NC"],["North Dakota","ND"],["Ohio","OH"],["Oklahoma","OK"],["Oregon","OR"],["Pennsylvania","PA"],["Rhode Island","RI"],["South Carolina","SC"],["South Dakota","SD"],["Tennessee","TN"],["Texas","TX"],["Utah","UT"],["Vermont","VT"],["Virginia","VA"],["Washington","WA"],["West Virginia","WV"],["Wisconsin","WI"],["Wyoming","WY"]];if("abbr"==e){for(a=a.replace(/\w\S*/g,function(a){return a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()}),i=0;i<n.length;i++)if(n[i][0]==a)return n[i][1]}else if("name"==e)for(a=a.toUpperCase(),i=0;i<n.length;i++)if(n[i][1]==a)return n[i][0]};
var map,gmap=function(o){"use strict";function a(){log("gmap.init() loaded"),e.mapcanvas=o(".js-gmap"),e.mapcanvas.length?n():log("gmap.init(): no mapcanvas found")}function n(){var o=document.createElement("script");o.type="text/javascript",o.id="new-gmap",o.src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAF1sRGF7ku7L3dKictevzxUTPWc2YF6NI&callback=gmap.build",document.body.appendChild(o)}function t(){var a=o.extend({},e.mapDefaults,{zoom:e.zoom,center:new google.maps.LatLng(e.latCenter,e.lonCenter),zoomControlOptions:{position:google.maps.ControlPosition.LEFT_CENTER},maxZoom:e.maxZoom,minZoom:e.minZoom,styles:[]});map=new google.maps.Map(e.mapcanvas[0],a)}var e={mapDefaults:{panControl:!1,zoomControl:!0,zoomControlOptions:!0,scaleControl:!1,mapTypeControl:!1,streetViewControl:!1,scrollwheel:!1,zoom:4,maxZoom:16,minZoom:3},mapcanvas:0,latCenter:37.09024,lonCenter:-96.712891};return{init:a,build:t}}(jQuery);
var mark=function(o){"use strict";function n(n,t,a,i){if(!o.isEmptyObject(r[t]))return void m.find(function(o){return o.title===t}).infowindow.setContent(i);var s=new google.maps.Geocoder,g=[];s.geocode({address:a},function(o,a){a==google.maps.GeocoderStatus.OK&&(g[0]=o[0].geometry.location.lat(),g[1]=o[0].geometry.location.lng(),r[t]=g,e(n,g,t,i))})}function e(o,n,e,a){var i=new google.maps.InfoWindow({content:a});if("All States"!==o){var r=new google.maps.LatLng(n[0],n[1]);map.panTo(r),map.setZoom(8)}var s=new google.maps.Marker({position:{lat:n[0],lng:n[1]},map:map,title:e,infowindow:i});log("marker for "+e),log(s),m.push(s),google.maps.event.addListener(s,"click",function(){t(),this.infowindow.open(map,this)})}function t(){m.map(function(o){o.infowindow.close()})}function a(o){var n=r[o][0],e=r[o][1],t=new google.maps.LatLng(n,e);map.panTo(t),map.setZoom(6)}function i(){var o=new google.maps.LatLng(37.09024,-96.712891);map.panTo(o),map.setZoom(4)}var r=[],m=[];return{buildMarkers:n,removeMarkers:t,moveToLocation:a,zoomOut:i}}(jQuery);
var makeAjax=function(a){"use strict";function e(e,t,n,o){a.ajax({url:t,method:"GET",dataType:"json",success:function(a){getData.cleanAreaCode(e,a,n,o)},error:function(){log("fail to get code")}})}function t(e,o,i,c,l,s){if(console.log(n),c>=o.length||1===n)return console.log("all data has loaded"),notify.waitFinished(),void(n=0);setTimeout(function(){-1===c?(log("make sync request: initialize -1 to negate setTimeout effect"),c+=1,a.ajax({url:o[c+1],success:function(a){t(e,o,i,c,l,s),getData.cleanData(e,a,i[c],l,s)},error:function(){log("initialize sync ajax failed: "+c),log("moving on to new ajax for next data:"),t(e,o,i,c,l,s)}})):(log("make sync request: "+c),a.ajax({url:o[c],method:"GET",dataType:"json",success:function(a){getData.cleanData(e,a,i[c],l,s),c+=1,t(e,o,i,c,l,s)},error:function(){log("load data failed: "+c+"for"+i[c]),log("moving on to new ajax for next data:"),c+=1,t(e,o,i,c,l,s)}}))},1e3)}var n=0;return function(){a(".js-search-location").submit(function(a){a.preventDefault(),n=1===n?0:1})}(),{sync:t,asyncGetCode:e}}(jQuery);
var info=function(e){"use strict";function a(e,a,r,t,l){var i="All States"===e?"":e,c=r+" "+i+" United States",n=["Place: @place <br>","@dataType: @displayData <br>","Average over: @time years"],p=l+"Yr"+t,s="All States"===e?a:a[e],o=s[r][p],d=0===o?"no data":o.format(2,3,",",".");"HousePrice"===l&&(d="$"+d),"PriceChange"===l&&(d+="%"),n=n.join("").replace("@place",r).replace("@dataType",l).replace("@displayData",d).replace("@time",t),mark.buildMarkers(e,r,c,n)}return{buildInfo:a}}(jQuery);
var notify=function(e){"use strict";function t(t){e(".js-notify-message").html(l.replace("@state",t)),e(".js-notify-timer").html(""),e(".js-notify-message-last").html(""),e(".js-notify").removeClass("slideOutDown"),e(".js-notify").addClass("slideInUp")}function s(t){e(".js-notify-message").html(a.join("")),n(t),e(".js-notify-message-last").html(o),e(".js-notify").removeClass("slideOutDown"),e(".js-notify").addClass("slideInUp")}function n(t){var s=t,n=document.getElementById("countdowntimer"),i=setInterval(function(){s--,n.classList.add("flipInX"),n.innerHTML=s,setTimeout(function(){n.classList.remove("flipInX")},980),e(".js-search-location").submit(function(e){e.preventDefault(),clearInterval(i)}),s<=0&&(e(".js-notify-message").html(""),clearInterval(i),n.innerHTML="sorry",e(".js-notify-message-last").html("please wait a little bit more, your connection seems to be unstable..."))},1e3)}function i(){e(".js-notify").removeClass("slideInUp"),e(".js-notify").addClass("slideOutDown")}var a=["Because this is a free service. ","There is an API limitation, please wait for "],o=" seconds for data to load",l="sorry, there doesn't seem to be data for @state";return{noData:t,waitTime:s,waitFinished:i}}(jQuery);
var getData=function(e){"use strict";function a(a,r,o){if(void 0===a&&(a="All States"),void 0===r&&(r=10),void 0===o&&(o="HousePrice"),u!==a&&("All States"===a?mark.zoomOut():(log("from"),mark.moveToLocation(a)),u=a,log("currentArea redefined")),"All States"!==a||e.isEmptyObject(c))if(e.isEmptyObject(d[a]))t(a,r,o);else{log("area data already exists"),mark.removeMarkers();for(var i in d[a])info.buildInfo(a,d,i,r,o)}else{log("state data already exists");for(var n in c)info.buildInfo(a,c,n,r,o)}}function t(a,t,r){if(e.support.cors=!0,"All States"===a)return void(e.isEmptyObject(s)?makeAjax.asyncGetCode(a,"state_code.json",t,r):(n="S",o(a,n,t,r)));log("get area codes"),e.isEmptyObject(l)?makeAjax.asyncGetCode(a,"neighborhood_code.json",t,r):(n="N",o(a,n,t,r))}function r(e,a,t,r){if("All States"===e)return n="S",s=a,void o(e,n,t,r);n="N",l=a;for(var i in l){var c=l[i]["City|Code"].split("|");l[i].Code=c[1]}o(e,n,t,r)}function o(e,a,t,r){var o,i=["https://www.quandl.com/api/v3/datasets/ZILL/",a,"@areaCode_A.json?collapse=annual","&api_key=1aGVznRZH7ckoyhVtges"],n=[],c=[];if("All States"===e)for(var u in s)o=i.join("").replace("@areaCode",s[u]),n.push(o),c.push(u);else{for(var f in l){var p=abbrState(e,"abbr");l[f].Metro===p&&(o=i.join("").replace("@areaCode",l[f].Code),n.push(o),c.push(f))}d[e]={}}if(0===n.length)return void notify.noData(e);notify.waitTime(n.length+10);makeAjax.sync(e,n,c,-1,t,r)}function i(e,a,t,r,o){var i,n=a.dataset.data,s={HousePriceYr1:0 in n?n[0][1]:0,HousePriceYr3:2 in n?n[2][1]:0,HousePriceYr5:4 in n?n[4][1]:0,HousePriceYr10:9 in n?n[9][1]:0,PriceChangeYr1:percentChg(n[0][1],1 in n?n[0][1]:0),PriceChangeYr3:percentChg(n[0][1],2 in n?n[2][1]:0),PriceChangeYr5:percentChg(n[0][1],4 in n?n[4][1]:0),PriceChangeYr10:percentChg(n[0][1],9 in n?n[9][1]:0)};"All States"===e?(c[t]=s,i=c):(d[e][t]=s,i=d),info.buildInfo(e,i,t,r,o)}var n,s={},c={},l={},d={},u="All States";return{from:a,cleanAreaCode:r,cleanData:i}}(jQuery);
!function(t){"use strict";log("app loaded"),function(){t(".js-search-location").submit(function(e){e.preventDefault();var a=t("#js-data-type option:selected").val(),o=t("#js-year option:selected").val(),i=t("#js-state option:selected").val();mark.removeMarkers(),notify.waitFinished(),getData.from(i,o,a)})}(),gmap.init(),getData.from("All States")}(jQuery);